name: Agentic

on:
  workflow_call:

jobs:
  gh-respond:
    if: |
      (github.event_name == 'issue_comment' && startsWith(github.event.comment.body, '@claude') && !startsWith(github.event.comment.body, '@claude /pr-start')) ||
      (github.event_name == 'issues' && startsWith(github.event.issue.body, '@claude'))
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: ./.github/actions/gh-respond
        with:
          secrets-json: ${{ toJSON(secrets) }}
          vars-json: ${{ toJSON(vars) }}

  pr-start:
    if: github.event_name == 'issue_comment' && !github.event.issue.pull_request && startsWith(github.event.comment.body, '@claude /pr-start')
    runs-on: ubuntu-latest
    timeout-minutes: 15
    steps:
      - uses: ./.github/actions/pr-start
        with:
          secrets-json: ${{ toJSON(secrets) }}
          vars-json: ${{ toJSON(vars) }}

  pr-fix:
    if: github.event_name == 'pull_request_review' && github.event.review.state == 'changes_requested' && startsWith(github.event.review.body, '@claude')
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: ./.github/actions/pr-fix
        with:
          secrets-json: ${{ toJSON(secrets) }}
          vars-json: ${{ toJSON(vars) }}

  pr-merge:
    if: github.event_name == 'pull_request_review' && github.event.review.state == 'approved' && startsWith(github.event.review.body, '@claude')
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: ./.github/actions/pr-merge
        with:
          secrets-json: ${{ toJSON(secrets) }}
          vars-json: ${{ toJSON(vars) }}
